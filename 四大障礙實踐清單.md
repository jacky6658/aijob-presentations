# 四大障礙實踐清單

**用途**：維運龍蝦測試 & 驗證用  
**建立日期**：2026-02-10  
**狀態**：待執行

---

## 一、Token 燒錢解決方案

### 1.1 成本監控機制

- [ ] **測試 `/status` 指令**
  - 確認可顯示 Token 用量
  - 確認可顯示成本統計
  - 記錄輸出格式

- [ ] **測試 `session_status` 功能**
  - 確認顯示當前 session 用量
  - 確認顯示累計成本
  - 截圖留存

- [ ] **研究 Gateway config 成本相關設定**
  - 找出 `costLimit` 或類似參數
  - 測試設定後的行為（超限會怎樣）
  - 記錄設定方式

### 1.2 預算警報系統

- [ ] **設計警報觸發條件**
  - 70% 預算 → 提醒
  - 90% 預算 → 警告
  - 100% 預算 → 暫停/降級

- [ ] **測試通知機制**
  - Telegram 通知是否正常
  - 通知內容是否清楚
  - 通知頻率是否合理

- [ ] **設計自動降級邏輯**
  - 超預算時自動切換便宜模型
  - 測試切換是否順暢
  - 確認用戶體驗影響

### 1.3 模型分級策略

- [ ] **建立模型分級表**

  | 任務類型 | 建議模型 | 成本/1K tokens | 備註 |
  |----------|----------|----------------|------|
  | 日常對話 | gemini-flash | $ | |
  | 文件整理 | gpt-4o-mini | $ | |
  | 複雜分析 | claude-sonnet | $$ | |
  | 關鍵任務 | claude-opus | $$$ | |

- [ ] **測試模型切換**
  - 確認可在 config 中設定 default model
  - 確認可用 `/model` 或類似指令切換
  - 測試切換後的回應品質差異

- [ ] **撰寫《Token 預算規劃指南》**
  - 包含：監控方式、預算設定、模型選擇建議
  - 格式：客戶可讀的說明文件

### 1.4 商業模式設計

- [ ] **設計預付制方案**
  - 定義 Token 包規格（例：10萬/50萬/100萬 tokens）
  - 定價策略
  - 儲值/扣款流程

- [ ] **設計用量報表**
  - 每週/每月用量報表格式
  - 自動發送機制

---

## 二、資安疑慮解決方案

### 2.1 資料流向說明

- [ ] **繪製資料流向圖**
  ```
  用戶輸入 → OpenClaw（本地）→ API → AI 服務商
       ↓
  記憶檔案（本地保存，不外傳）
  ```

- [ ] **整理各服務商隱私政策**
  - [ ] OpenAI API 資料使用政策
  - [ ] Anthropic API 資料使用政策
  - [ ] Google AI API 資料使用政策
  - 重點摘要：是否用於訓練、保留多久、加密方式

- [ ] **撰寫《資安說明書》**
  - 用白話文解釋資料怎麼流動
  - 說明哪些資料會/不會外傳
  - 提供安心保證

### 2.2 分級保護方案

- [ ] **基礎版設定**
  - 確認 memory 檔案只存本地
  - 確認 API 傳輸使用 HTTPS
  - 確認無敏感資訊寫入日誌

- [ ] **進階版設定**
  - 測試企業版 API（OpenAI/Anthropic 的 Enterprise 方案）
  - 設計敏感資料脫敏指南
  - 建立資料分類標準（什麼可以/不可以給 AI）

- [ ] **極致版測試**
  - [ ] 安裝 Ollama
  - [ ] 測試 Ollama + OpenClaw 整合
  - [ ] 評估本地模型品質（與雲端模型對比）
  - [ ] 記錄設定步驟
  - [ ] 評估硬體需求

### 2.3 合規文件

- [ ] **準備隱私政策**
  - 說明我們如何處理客戶資料
  - 符合個資法要求

- [ ] **準備資料處理協議（DPA）**
  - 企業客戶可能需要簽署

---

## 三、穩定度解決方案

### 3.1 自動重啟機制

- [ ] **測試 systemd 管理**
  ```bash
  # 建立 service 檔案
  sudo nano /etc/systemd/system/openclaw.service
  
  # 測試指令
  sudo systemctl start openclaw
  sudo systemctl enable openclaw
  sudo systemctl status openclaw
  ```
  - 確認開機自動啟動
  - 確認崩潰後自動重啟
  - 記錄設定步驟

- [ ] **測試 pm2 管理**
  ```bash
  pm2 start "openclaw gateway start" --name openclaw
  pm2 save
  pm2 startup
  ```
  - 確認進程監控正常
  - 確認自動重啟正常
  - 記錄設定步驟

- [ ] **選擇推薦方案**
  - 比較 systemd vs pm2 優缺點
  - 確定預設推薦方案

### 3.2 健康檢查機制

- [ ] **設計健康檢查腳本**
  ```bash
  # 檢查 Gateway 是否運行
  openclaw gateway status
  
  # 檢查 API 是否可用
  curl -s http://localhost:PORT/health
  ```

- [ ] **設定檢查頻率**
  - 建議：每 5 分鐘檢查一次
  - 連續 2 次失敗才告警（避免誤報）

- [ ] **整合到維運龍蝦 Heartbeat**
  - 在 HEARTBEAT.md 加入檢查任務
  - 測試自動檢查流程

### 3.3 錯誤通知機制

- [ ] **測試 Telegram 通知**
  - Gateway 崩潰時是否收到通知
  - 通知內容是否包含足夠資訊
  - 通知是否即時

- [ ] **設計通知模板**
  ```
  🚨 Gateway 異常
  
  【客戶】XXX
  【狀態】無回應
  【時間】2026-02-10 14:30
  【已嘗試】自動重啟 1 次
  【結果】失敗
  
  需要人工介入
  ```

- [ ] **設定告警升級機制**
  - Level 1：自動重啟
  - Level 2：通知維運龍蝦
  - Level 3：通知人類

### 3.4 備份機制

- [ ] **設計備份策略**
  - 備份內容：memory/、MEMORY.md、config
  - 備份頻率：每日
  - 保留天數：7 天

- [ ] **測試 Git 備份**
  ```bash
  cd /path/to/workspace
  git add -A
  git commit -m "Daily backup $(date +%Y-%m-%d)"
  git push
  ```

- [ ] **設定自動備份 Cron**
  ```bash
  # 每天凌晨 3 點備份
  0 3 * * * /path/to/backup-script.sh
  ```

### 3.5 撰寫《穩定運行 SOP》

- [ ] **包含內容**
  - 安裝後的穩定性設定步驟
  - 常見故障排除指南
  - 緊急恢復流程

---

## 四、出事找誰解決方案

### 4.1 服務合約

- [ ] **擬定服務合約範本**
  - 服務範圍定義
  - 服務時間（工作日/全年無休）
  - 回應時間承諾
  - 責任範圍與上限
  - 免責條款

- [ ] **設計 SLA 層級**

  | 層級 | 回應時間 | 服務時段 | 適用方案 |
  |------|----------|----------|----------|
  | 基礎 | 48 小時 | 工作日 | 快速安裝包 |
  | 標準 | 24 小時 | 工作日 | 標準託管 |
  | 專業 | 4 小時 | 9-21 時 | 專業託管 |
  | 企業 | 1 小時 | 24/7 | 企業方案 |

### 4.2 問題回報流程

- [ ] **設計客戶回報管道**
  - Telegram Bot？
  - Email？
  - 表單？

- [ ] **設計工單系統**
  - 問題分類
  - 優先級定義
  - 處理流程

- [ ] **設計升級機制**
  ```
  客戶回報
      ↓
  維運龍蝦初步處理（15 分鐘內回應）
      ↓
  [可解決] → 處理完成 → 回報客戶
      ↓
  [無法解決] → 升級人類 → 附上已嘗試的方案
  ```

### 4.3 操作記錄

- [ ] **設計日誌格式**
  ```json
  {
    "timestamp": "2026-02-10T14:30:00+08:00",
    "customer": "客戶 A",
    "event": "gateway_restart",
    "trigger": "health_check_failed",
    "action": "執行重啟",
    "result": "success",
    "duration_seconds": 45
  }
  ```

- [ ] **設定日誌保留期限**
  - 建議：90 天

- [ ] **設計稽核報表**
  - 每月操作統計
  - 問題類型分布
  - 處理時效分析

### 4.4 客戶培訓

- [ ] **設計 Onboarding 流程**
  - 基本操作教學
  - 常見問題 FAQ
  - 問題回報方式

- [ ] **準備教學文件**
  - 快速入門指南
  - 影片教學（可選）

---

## 五、驗收標準

### 5.1 Token 燒錢 ✅ 條件

- [ ] 可查看即時用量
- [ ] 可設定預算上限
- [ ] 超預算有通知
- [ ] 有模型分級策略文件

### 5.2 資安疑慮 ✅ 條件

- [ ] 有完整資料流向說明
- [ ] 有各服務商隱私政策摘要
- [ ] 有《資安說明書》
- [ ] Ollama 本地模型測試完成（可選）

### 5.3 穩定度 ✅ 條件

- [ ] 自動重啟機制正常
- [ ] 健康檢查正常
- [ ] 錯誤通知正常
- [ ] 備份機制正常
- [ ] 有《穩定運行 SOP》

### 5.4 出事找誰 ✅ 條件

- [ ] 有服務合約範本
- [ ] 有問題回報流程
- [ ] 有操作記錄機制
- [ ] 有客戶培訓材料

---

## 六、產出文件清單

| 文件 | 狀態 | 負責人 | 完成日期 |
|------|------|--------|----------|
| 《Token 預算規劃指南》 | ⬜ 待做 | | |
| 《模型分級策略表》 | ⬜ 待做 | | |
| 《資安說明書》 | ⬜ 待做 | | |
| 《各服務商隱私政策摘要》 | ⬜ 待做 | | |
| 《穩定運行 SOP》 | ⬜ 待做 | | |
| 《服務合約範本》 | ⬜ 待做 | | |
| 《問題回報 SOP》 | ⬜ 待做 | | |
| 《客戶快速入門指南》 | ⬜ 待做 | | |

---

## 七、測試環境

### 7.1 測試用 OpenClaw 設定

```yaml
# 測試環境資訊（待填）
主機：
IP：
SSH：
Gateway 版本：
測試帳號：
```

### 7.2 測試客戶模擬

- 客戶 A（模擬）：一般用戶
- 客戶 B（模擬）：重度用戶
- 客戶 C（模擬）：企業用戶

---

**下一步**：指派維運龍蝦開始逐項測試

**更新記錄**：
- 2026-02-10：初版建立
