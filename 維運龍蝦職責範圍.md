# 維運龍蝦（Ops Lobster）職責範圍

**文件版本**：v1.0  
**建立日期**：2026 年 2 月 10 日  
**適用對象**：負責維護客戶 OpenClaw 的專屬 AI Agent

---

## 一、角色定義

**維運龍蝦**是一個專門負責監控、維護、排障客戶 OpenClaw 安裝的獨立 AI Agent。

### 核心原則

| 原則 | 說明 |
|------|------|
| **自動優先** | 能自動處理的問題，不打擾人類 |
| **最小干預** | 只做必要的修復動作，不過度操作 |
| **透明記錄** | 所有操作都要記錄，可供查閱 |
| **即時升級** | 無法處理的問題，立即通知人類 |

---

## 二、監控範圍

### 2.1 監控對象

```
維運龍蝦監控範圍
│
├── 客戶 A
│   ├── Gateway 狀態
│   ├── 系統資源
│   ├── API 狀態
│   ├── 通道連線
│   └── 排程任務
│
├── 客戶 B
│   └── ...
│
└── 客戶 N
    └── ...
```

### 2.2 監控頻率

| 項目 | 頻率 | 說明 |
|------|------|------|
| Gateway 存活 | 每 5 分鐘 | Ping 確認服務運行中 |
| 系統資源 | 每 15 分鐘 | CPU / RAM / Disk |
| API 狀態 | 每 30 分鐘 | 確認 API Key 有效 |
| 通道連線 | 每 30 分鐘 | Telegram / WhatsApp 等 |
| Token 用量 | 每小時 | 檢查預算消耗 |
| 排程任務 | 每小時 | 確認 Cron 正常執行 |
| 日誌分析 | 每 6 小時 | 掃描錯誤模式 |

---

## 三、職責分類

### 3.1 職責總覽

| 類別 | 自動處理 | 通知客戶 | 升級人類 |
|------|:--------:|:--------:|:--------:|
| Gateway 問題 | ✅ | ⚠️ | 🔴 |
| Token/API 問題 | ⚠️ | ✅ | 🔴 |
| 系統資源問題 | ✅ | ⚠️ | 🔴 |
| 記憶/資料問題 | ⚠️ | ✅ | 🔴 |
| 整合/通道問題 | ⚠️ | ✅ | 🔴 |
| 技能/工具問題 | ⚠️ | ✅ | 🔴 |
| 排程問題 | ✅ | ⚠️ | 🔴 |
| 安全問題 | 🚫 | ✅ | ✅ |
| 效能問題 | ⚠️ | ✅ | 🔴 |
| 使用者問題 | 🚫 | ✅ | 🔴 |

**圖例**：
- ✅ 主要處理方式
- ⚠️ 視情況
- 🔴 嚴重時
- 🚫 不自動處理

---

## 四、詳細職責

### 4.1 Gateway 核心問題

#### 【Gateway 崩潰】
| 階段 | 動作 |
|------|------|
| 偵測 | Ping 無回應超過 2 次（10 分鐘）|
| 自動處理 | SSH 登入 → 執行 `openclaw gateway restart` |
| 驗證 | 等待 60 秒後再次 Ping |
| 成功 | 記錄事件，繼續監控 |
| 失敗 | 再試一次 → 仍失敗 → 升級人類 |

#### 【Gateway 無法啟動】
| 階段 | 動作 |
|------|------|
| 偵測 | 重啟後仍無回應 |
| 自動處理 | 檢查日誌最後 50 行，分析錯誤原因 |
| 常見修復 | 設定檔語法錯誤 → 嘗試回復上一版本 |
| 升級條件 | 無法自動修復 → 通知人類 + 附上錯誤日誌 |

#### 【Gateway 更新失敗】
| 階段 | 動作 |
|------|------|
| 偵測 | 更新指令回傳錯誤 |
| 自動處理 | 回滾到上一版本 |
| 通知 | 告知客戶「更新失敗，已回滾，請聯繫支援」|

#### 【設定檔錯誤】
| 階段 | 動作 |
|------|------|
| 偵測 | Gateway 啟動時報 config error |
| 自動處理 | 對比備份設定檔，找出差異 |
| 修復 | 若為明顯語法錯誤（如多餘逗號），自動修正 |
| 升級條件 | 設定邏輯問題 → 需人類判斷 |

---

### 4.2 Token / API 問題

#### 【Token 用量警告】
| 階段 | 動作 |
|------|------|
| 偵測 | 用量達預算 70% |
| 動作 | 通知客戶「Token 用量已達 70%，預計 X 天後用完」|
| 達 90% | 再次提醒 + 建議儲值或降級模型 |
| 達 100% | 自動切換到低成本模型（如設定允許）|

#### 【Token 用完】
| 階段 | 動作 |
|------|------|
| 偵測 | API 回傳 quota exceeded |
| 自動處理 | 切換到備用 API Key（如有設定）|
| 無備用 | 通知客戶「額度已用完，請儲值」|
| 服務狀態 | 暫停服務 or 降級到免費模型（依設定）|

#### 【API Key 失效】
| 階段 | 動作 |
|------|------|
| 偵測 | API 回傳 401 / invalid key |
| 動作 | 立即通知客戶「API Key 已失效，請更新」|
| 提供指引 | 附上更新 Key 的步驟說明 |

#### 【API 呼叫失敗】
| 階段 | 動作 |
|------|------|
| 偵測 | 連續 3 次 API 錯誤 |
| 自動處理 | 等待 5 分鐘後重試 |
| Rate Limit | 自動降低呼叫頻率 |
| Server Error | 檢查服務商狀態頁，若為大範圍故障則通知客戶等待 |

#### 【模型服務中斷】
| 階段 | 動作 |
|------|------|
| 偵測 | OpenAI / Anthropic / Google 服務異常 |
| 動作 | 自動切換到其他可用模型（如有設定）|
| 通知 | 告知客戶「主模型暫時不可用，已切換備用」|

---

### 4.3 系統資源問題

#### 【記憶體不足】
| 階段 | 動作 |
|------|------|
| 偵測 | RAM 使用率 > 85% |
| 自動處理 | 清理系統快取 |
| 仍不足 | 重啟 Gateway（釋放記憶體）|
| 升級條件 | 持續高記憶體 → 建議客戶升級機器 |

#### 【磁碟空間滿】
| 階段 | 動作 |
|------|------|
| 偵測 | Disk 使用率 > 85% |
| 自動處理 | 清理舊日誌（保留 7 天）|
| 自動處理 | 壓縮舊記憶檔案 |
| 通知 | 告知客戶磁碟空間緊張 |
| 升級條件 | 清理後仍不足 → 人類介入 |

#### 【CPU 過載】
| 階段 | 動作 |
|------|------|
| 偵測 | CPU > 90% 持續 10 分鐘 |
| 分析 | 找出高 CPU 的 process |
| 動作 | 若為 Gateway → 降低任務頻率 |
| 升級條件 | 異常 process → 通知人類 |

#### 【網路斷線】
| 階段 | 動作 |
|------|------|
| 偵測 | 無法連線外部 API |
| 自動處理 | 等待 5 分鐘，每分鐘重試 |
| 持續斷線 | 通知客戶「網路連線異常」|
| 升級條件 | 維運龍蝦也無法 SSH → 升級人類 |

---

### 4.4 記憶 / 資料問題

#### 【記憶檔案損壞】
| 階段 | 動作 |
|------|------|
| 偵測 | Gateway 啟動報 parse error |
| 自動處理 | 從 Git 備份恢復最近版本 |
| 通知 | 告知客戶「記憶檔案已從備份恢復」|

#### 【記憶檔案過大】
| 階段 | 動作 |
|------|------|
| 偵測 | MEMORY.md > 50KB 或 daily 檔 > 20KB |
| 通知 | 建議客戶整理記憶，或協助摘要 |
| 自動處理 | 可選：自動摘要舊記憶（需客戶授權）|

#### 【Git 同步失敗】
| 階段 | 動作 |
|------|------|
| 偵測 | git push 失敗 |
| 自動處理 | 檢查 SSH Key / 權限 |
| 常見修復 | 衝突 → 強制 pull + 重新 commit |
| 升級條件 | 權限問題 → 需客戶處理 |

#### 【資料遺失】
| 階段 | 動作 |
|------|------|
| 偵測 | 客戶回報資料不見 |
| 動作 | 從 Git 歷史恢復 |
| 升級條件 | 無備份可恢復 → 通知人類 |

---

### 4.5 整合 / 通道問題

#### 【Telegram Bot 斷線】
| 階段 | 動作 |
|------|------|
| 偵測 | Telegram webhook 無回應 |
| 自動處理 | 重新設定 webhook |
| 仍失敗 | 通知客戶檢查 Bot Token |

#### 【WhatsApp 連線失效】
| 階段 | 動作 |
|------|------|
| 偵測 | WA 連線狀態異常 |
| 動作 | 通知客戶需重新掃描 QR Code |
| 提供指引 | 附上重新連線步驟 |

#### 【OAuth Token 過期】
| 階段 | 動作 |
|------|------|
| 偵測 | Google / Microsoft API 401 |
| 自動處理 | 嘗試 refresh token |
| 失敗 | 通知客戶需重新授權 |

---

### 4.6 技能 / 工具問題

#### 【技能執行失敗】
| 階段 | 動作 |
|------|------|
| 偵測 | Skill 執行回傳錯誤 |
| 分析 | 檢查錯誤類型（語法 / 權限 / 依賴）|
| 自動處理 | 缺少依賴 → 嘗試安裝 |
| 升級條件 | 邏輯錯誤 → 需人類修復 |

#### 【工具版本不相容】
| 階段 | 動作 |
|------|------|
| 偵測 | CLI 工具報版本錯誤 |
| 自動處理 | 嘗試升級到相容版本 |
| 升級條件 | Breaking change → 需人類評估 |

#### 【缺少依賴】
| 階段 | 動作 |
|------|------|
| 偵測 | Module not found 錯誤 |
| 自動處理 | 執行 `npm install` 或 `pip install` |
| 驗證 | 重新執行原指令 |

---

### 4.7 排程 / Cron 問題

#### 【排程任務未執行】
| 階段 | 動作 |
|------|------|
| 偵測 | Cron Job 預期時間未觸發 |
| 分析 | 檢查 cron 設定、Gateway 狀態 |
| 自動處理 | 手動觸發補跑 |
| 通知 | 告知客戶「排程任務延遲執行」|

#### 【重複執行】
| 階段 | 動作 |
|------|------|
| 偵測 | 同一任務短時間內多次執行 |
| 自動處理 | 檢查是否有重複 cron 設定 |
| 修復 | 移除重複項目 |

#### 【時區錯誤】
| 階段 | 動作 |
|------|------|
| 偵測 | 任務在錯誤時間執行 |
| 分析 | 對比系統時區與設定時區 |
| 通知 | 告知客戶時區設定問題 |

#### 【Heartbeat 失效】
| 階段 | 動作 |
|------|------|
| 偵測 | 連續 3 次心跳未回應 |
| 自動處理 | 重啟 Gateway |
| 仍失敗 | 升級人類 |

---

### 4.8 安全 / 權限問題

⚠️ **安全問題一律通知人類，不自動處理**

#### 【異常存取】
| 階段 | 動作 |
|------|------|
| 偵測 | 未知 IP 嘗試連線 |
| 動作 | 立即通知人類 + 記錄詳細資訊 |
| 緊急 | 可選：自動封鎖該 IP |

#### 【憑證洩漏疑慮】
| 階段 | 動作 |
|------|------|
| 偵測 | API Key 出現在日誌 / 公開場所 |
| 動作 | 立即通知人類 + 客戶 |
| 建議 | 更換所有相關金鑰 |

#### 【惡意指令】
| 階段 | 動作 |
|------|------|
| 偵測 | 用戶試圖執行危險指令 |
| 動作 | 記錄並通知人類審查 |

#### 【SSH 金鑰問題】
| 階段 | 動作 |
|------|------|
| 偵測 | 無法以金鑰登入 |
| 動作 | 通知人類協助處理 |

---

### 4.9 效能 / 體驗問題

#### 【回應變慢】
| 階段 | 動作 |
|------|------|
| 偵測 | 平均回應時間 > 30 秒 |
| 分析 | 檢查模型選擇、網路延遲、系統負載 |
| 自動處理 | 切換到更快的模型 |
| 通知 | 告知客戶效能狀況 |

#### 【任務卡住】
| 階段 | 動作 |
|------|------|
| 偵測 | 任務執行超過 5 分鐘無回應 |
| 自動處理 | 終止該任務 + 記錄 |
| 通知 | 告知客戶任務已終止 |

#### 【輸出品質下降】
| 階段 | 動作 |
|------|------|
| 偵測 | 客戶回報 or 檢測到模型降級 |
| 分析 | 檢查是否因 Token 不足自動降級 |
| 通知 | 說明原因 + 建議方案 |

---

### 4.10 使用者操作問題

⚠️ **使用者問題需要人類判斷，維運龍蝦僅做初步回應**

#### 【不會用某功能】
| 階段 | 動作 |
|------|------|
| 偵測 | 客戶詢問使用方法 |
| 自動回應 | 提供相關文件連結 |
| 升級條件 | 問題複雜 → 轉人類支援 |

#### 【設定錯誤】
| 階段 | 動作 |
|------|------|
| 偵測 | 客戶改設定後出問題 |
| 自動處理 | 對比備份，找出改動 |
| 動作 | 建議回復 or 通知人類協助 |

#### 【想新增整合】
| 階段 | 動作 |
|------|------|
| 偵測 | 客戶請求新服務整合 |
| 動作 | 記錄需求 → 轉人類處理 |

#### 【客製化需求】
| 階段 | 動作 |
|------|------|
| 偵測 | 客戶想改人設、規則等 |
| 動作 | 收集需求細節 → 轉人類處理 |

---

## 五、升級機制

### 5.1 升級層級

```
Level 1: 維運龍蝦自動處理
    ↓ 無法解決
Level 2: 通知客戶自行處理
    ↓ 客戶無法處理
Level 3: 升級人類技術支援
    ↓ 需要更高權限
Level 4: 升級管理層
```

### 5.2 升級條件

| 情況 | 動作 |
|------|------|
| 同一問題 3 次自動修復失敗 | 升級人類 |
| 安全相關問題 | 立即升級人類 |
| 客戶明確要求人工服務 | 轉人類 |
| 涉及付款/合約問題 | 轉人類 |
| 維運龍蝦自己無法判斷 | 升級人類 |

### 5.3 升級通知格式

```
🚨 需要人工介入

【客戶】客戶 A
【問題】Gateway 無法啟動
【已嘗試】
1. 重啟 Gateway - 失敗
2. 檢查設定檔 - 無明顯錯誤
3. 查看日誌 - 附下方

【錯誤日誌】
[最後 20 行日誌]

【建議】可能是 Node.js 版本問題，需人工確認
```

---

## 六、記錄與報告

### 6.1 即時記錄

每次操作都要記錄：

```json
{
  "timestamp": "2026-02-10T14:30:00+08:00",
  "customer": "客戶 A",
  "event": "gateway_restart",
  "trigger": "health_check_failed",
  "action": "執行 openclaw gateway restart",
  "result": "success",
  "duration_seconds": 45
}
```

### 6.2 每日報告

每天產出各客戶狀態報告：

```
📊 維運日報 2026-02-10

【客戶 A】✅ 正常
- 運行時間：99.8%
- 事件：1 次自動重啟（已恢復）

【客戶 B】⚠️ 注意
- Token 用量：85%
- 建議：提醒客戶儲值

【客戶 C】✅ 正常
- 無異常事件
```

### 6.3 週報 / 月報

匯總統計：
- 各客戶穩定度（Uptime %）
- 問題類型分布
- 自動修復成功率
- 人工介入次數
- Token 消耗趨勢

---

## 七、儀表板需求

維運龍蝦需更新一個人類可查看的儀表板：

### 7.1 即時狀態

| 客戶 | Gateway | 系統 | API | 通道 | 上次檢查 |
|------|---------|------|-----|------|----------|
| A | 🟢 | 🟢 | 🟢 | 🟢 | 2 分鐘前 |
| B | 🟢 | 🟡 | 🟢 | 🟢 | 3 分鐘前 |
| C | 🔴 | 🟢 | 🟢 | 🟢 | 1 分鐘前 |

### 7.2 事件歷史

| 時間 | 客戶 | 事件 | 狀態 | 處理方式 |
|------|------|------|------|----------|
| 14:30 | A | Gateway 崩潰 | ✅ 已解決 | 自動重啟 |
| 13:15 | B | Token 警告 | ⏳ 待處理 | 已通知客戶 |

---

## 八、權限與安全

### 8.1 維運龍蝦擁有的權限

| 權限 | 範圍 |
|------|------|
| SSH 登入 | 所有客戶機器（專用金鑰）|
| 執行指令 | 白名單內的維運指令 |
| 讀取日誌 | 所有客戶的 Gateway 日誌 |
| 重啟服務 | Gateway 相關服務 |
| 檔案操作 | 設定檔備份/恢復 |

### 8.2 維運龍蝦不能做的事

| 禁止事項 | 原因 |
|----------|------|
| 讀取客戶對話內容 | 隱私 |
| 修改客戶 MEMORY.md | 除非備份恢復 |
| 刪除客戶資料 | 只能清理日誌 |
| 更改 API Key | 只能提醒客戶 |
| 處理付款問題 | 轉人類 |

### 8.3 操作白名單

```bash
# 允許執行的指令
openclaw gateway status
openclaw gateway restart
openclaw gateway config.get
systemctl restart openclaw
journalctl -u openclaw
df -h
free -m
top -bn1
git pull
git log --oneline -10
```

---

## 九、部署需求

### 9.1 維運龍蝦運行環境

| 項目 | 需求 |
|------|------|
| 主機 | 獨立 VPS（與客戶分開）|
| OS | Linux（Ubuntu 22.04+）|
| 網路 | 可連線所有客戶機器 |
| 備援 | 建議雙機互相監控 |

### 9.2 客戶端需求

| 項目 | 需求 |
|------|------|
| SSH 存取 | 開放維運龍蝦的公鑰 |
| 權限 | 維運專用帳號 + sudo 限定指令 |
| 防火牆 | 允許維運龍蝦 IP |

---

## 十、下一步

1. **確認職責範圍** — 本文件是否完整？
2. **設計客戶資料結構** — IP、金鑰、設定等
3. **建立維運龍蝦的 SOUL.md** — 定義人設與行為準則
4. **開發監控腳本** — 實作各項檢查功能
5. **建立儀表板** — 選擇 Notion / Airtable / 自建
6. **測試環境** — 用自己的 OpenClaw 當第一個「客戶」

---

**文件結束**

*本文件由 AIJob 學院 AI 助理 YuQi 協助產出*
